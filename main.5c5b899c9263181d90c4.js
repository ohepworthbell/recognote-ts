(()=>{"use strict";(()=>{const t=JSON.parse('{"a":{"frequency":27.5,"notes":["flat","sharp"],"chords":["minor","major","major7"]},"b":{"frequency":30.87,"notes":["flat","sharp"],"chords":["minor","major","major7"]},"c":{"frequency":16.35,"notes":["flat","sharp"],"chords":["minor","major","major7"]},"d":{"frequency":18.35,"notes":["flat","sharp"],"chords":["minor","major","major7"]},"e":{"frequency":20.6,"notes":["flat","sharp"],"chords":["minor","major","major7"]},"f":{"frequency":21.83,"notes":["flat","sharp"],"chords":["minor","major","major7"]},"g":{"frequency":24.5,"notes":["flat","sharp"],"chords":["minor","major","major7"]}}'),e=JSON.parse('{"nodes":100,"canvasSize":700,"ringRadius":170,"noteRadius":260,"lineWidth":9,"maxOffset":100,"hardMode":false,"instrument":"midi"}');function n(t){return/[A-Z]/.test(t)?t.replace(/([A-Z])/g,(function(t){return"-"+t[0].toLowerCase()})):t}var r=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},o=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};function i(t,e,i){var a,s,c;if(this.element=document.createElement(t),e)try{for(var u=r(Object.entries(e)),h=u.next();!h.done;h=u.next()){var d=o(h.value,2),f=d[0],l=d[1];this.element.setAttribute(n(f),String(l))}}catch(t){a={error:t}}finally{try{h&&!h.done&&(s=u.return)&&s.call(u)}finally{if(a)throw a.error}}return i&&(c=this.element).append.apply(c,function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(o(arguments[e]));return t}(i)),this.element}function a(t,e,i,a){var s,c;if(this.image=new Image(e,i),this.image.src=t,a)try{for(var u=r(Object.entries(a)),h=u.next();!h.done;h=u.next()){var d=o(h.value,2),f=d[0],l=d[1];this.image.setAttribute(n(f),String(l))}}catch(t){s={error:t}}finally{try{h&&!h.done&&(c=u.return)&&c.call(u)}finally{if(s)throw s.error}}return this.image}var s=function(){return(s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},c={nodes:30,canvasSize:700,ringRadius:190,noteRadius:220,maxOffset:40,lineWidth:12,hardMode:!1,instrument:"midi"};const u=function(t){return s(s({},c),t)},h=function(){function t(t,e,n,r){this.angle=t,this.radius=e,this.midPoint=n,this.maxOffset=this.offset=r,this.ease=0,this.tween=0,this.direction=1,this.active=!1}return t.prototype.start=function(){this.active=!0,this.offset=this.maxOffset*Math.random()-this.maxOffset/2,this.resetTween()},t.prototype.end=function(){this.active=!1},Object.defineProperty(t.prototype,"coords",{get:function(){this.updateEasing(),this.offset*=.987;var t=this.radius+this.offset*this.ease;return{x:t*Math.cos(this.angle)+this.midPoint,y:t*Math.sin(this.angle)+this.midPoint}},enumerable:!1,configurable:!0}),t.prototype.resetTween=function(){this.direction*=-1;var t=Math.max(.2*Math.random(),.05);this.tween=t*this.direction},t.prototype.updateEasing=function(){if(!this.active){if(0===this.ease)return 0;this.tween=this.ease/-15}return this.ease+=this.tween,(t=this.ease)<.5?2*t*t:(4-2*t)*t-1;var t},Object.defineProperty(t.prototype,"ease",{get:function(){return this._ease},set:function(t){Math.abs(t)>1&&this.resetTween(),this._ease=Math.max(Math.min(t,1),-1)},enumerable:!1,configurable:!0}),t}(),d=function(){function t(t,e){this.wrapper=document.getElementById(t),this.settings=u(e),this.nodes=function(t){for(var e=[],n=2*Math.PI/t.nodes,r=t.ringRadius,o=t.canvasSize/2,i=t.maxOffset,a=0;a<t.nodes;a++){var s=n*a;e.push(new h(s,r,o,i))}return e}(this.settings),this.createWheel()}return t.prototype.createWheel=function(){this.createGameArea(),this.addGameLineGradient(),this.animate()},t.prototype.animate=function(){var t,e=this;(t=function(){e.drawLine(),window.requestAnimationFrame(t)})()},t.prototype.createGameArea=function(){var t=this.settings.canvasSize,e=new i("canvas",{width:t,height:t,class:"game__canvas"});this.ctx=e.getContext("2d");var n=new i("button",{type:"button",title:"Play sound",class:"game__play-button button"},new a("img/volume.svg",30,30,{title:"Volume icon",class:"game__play-button__icon"}));this.wrapper.append(e,n),this.dom={canvas:e,button:n}},t.prototype.addGameLineGradient=function(){var t=this.dom.canvas,e=this.ctx,n=e.createLinearGradient(0,t.height,t.width,0);n.addColorStop(.3,"#3762d2"),n.addColorStop(.6,"#24c597"),e.strokeStyle=n,e.lineWidth=this.settings.lineWidth,e.lineJoin="round"},t.prototype.drawLine=function(){var t=this.dom.canvas,e=this.ctx,n=this.nodes,r=n.length-1;e.clearRect(0,0,t.width,t.height);var o=n[0].coords,i=n[r].coords,a={x:(o.x+i.x)/2,y:(o.y+i.y)/2};e.beginPath(),e.moveTo(a.x,a.y);for(var s=0;s<r;s++){var c=n[s].coords,u=n[s+1].coords,h={x:(c.x+u.x)/2,y:(c.y+u.y)/2};e.quadraticCurveTo(c.x,c.y,h.x,h.y)}e.quadraticCurveTo(i.x,i.y,a.x,a.y),e.closePath(),e.stroke()},t}();function f(t,e,n){var r=new i("span",{class:"game__score__number",role:"none"},String(t));return this.box=new i("div",{class:"game__score game__score--"+e,ariaLabel:n,ariaLive:"polite"},[n,r]),this.box.addEventListener("update-score",(function(t){r.textContent=String(t.detail)})),this.box}function l(t,e){void 0===e&&(e=!1);var n="toast-"+Math.random().toString(36).substr(2,7),r=new i("button",{class:"toasts__close",type:"button",title:"Close",ariaLabel:"Close",ariaAtomic:!0,ariaControls:n},"Ã—"),o=new i("dialogue",{class:"toasts__modal toasts__modal--"+(e?"success":"error"),id:n},[t,r]),a=setTimeout((function(){o.remove()}),2e3);r.addEventListener("click",(function(t){t.preventDefault(),o.remove()})),o.addEventListener("mouseenter",(function(){clearTimeout(a)})),document.getElementById("toasts").append(o)}const p=function(){function t(t){this.correct,this.constructDom(t),this.score=0,this.topscore=0}return t.prototype.constructDom=function(t){var e=new f(this.score,"left","Current score"),n=new f(this.topscore,"right","Top streak");t.append(e,n),this.dom={current:e,top:n}},t.prototype.check=function(t){if(t.toUpperCase()===this.correct.toUpperCase())return this.score++,this.topscore=this.score,this.score>0&&this.score===this.topscore&&this.dom.top.classList.add("game__score--streak"),void l("You are correct!",!0);this.dom.top.classList.remove("game__score--streak"),this.score=0,window.navigator.vibrate&&window.navigator.vibrate(200),l("Oops, wrong answer! The correct answer was '"+this.correct.toUpperCase()+"'")},Object.defineProperty(t.prototype,"topscore",{get:function(){return Number(localStorage.getItem("topScore")||0)},set:function(t){var e=Math.max(t,this.topscore);localStorage.setItem("topScore",String(e)),this.dom.top.dispatchEvent(new CustomEvent("update-score",{detail:e}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"score",{get:function(){return this._score||0},set:function(t){this._score=t,this.dom.current.dispatchEvent(new CustomEvent("update-score",{detail:this._score}))},enumerable:!1,configurable:!0}),t}();function m(t,e,n){var r,o,i=(r=t,o=n,function(t){return Number((r*t+o).toFixed(2))});return{x:i(Math.cos(e)),y:i(Math.sin(e))}}function v(t,e,n,r){void 0===n&&(n=120),void 0===r&&(r=0);var o=t.toUpperCase(),a=new m(n,e,r),s=a.x,c=a.y;return this.button=new i("button",{type:"button",class:"game__answer",style:"top: "+c+"px; left: "+s+"px",title:o,ariaLabel:"Answer button"},o),this.button}const y=function(){function t(t,e,n){void 0===n&&(n=4);var r=t[e].frequency;this.frequency=function(t,e){for(void 0===e&&(e=4);e--;)t*=2;return Number(t.toFixed(2))}(r,n)}return t.prototype.play=function(){var t=new window.AudioContext,e=t.createOscillator();e.type="sine",e.connect(t.destination),e.frequency.value=this.frequency,e.start(),e.stop(t.currentTime+.3)},t}();var w,g=(w=function(t,e){return(w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}w(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});new(function(t){function e(e,n,r){var o=t.call(this,e,r)||this;return o.notes=n,o.answers=[],o.scoreboard=new p(o.wrapper),o.newRound(!0),o}return g(e,t),e.prototype.newRound=function(t){void 0===t&&(t=!1),this.clearPreviousRounds(),this.setCorrectAnswer(),this.createNewSound(),this.addAnswerButtons(),t&&this.addSoundButtonListeners()},e.prototype.clearPreviousRounds=function(){this.answers.length&&(this.answers.forEach((function(t){return t.remove()})),this.answers=[])},e.prototype.setCorrectAnswer=function(){var t=Object.keys(this.notes);this.scoreboard.correct=t[Math.floor(Math.random()*t.length)]},e.prototype.createNewSound=function(){var t=this.settings.hardMode,e=this.scoreboard.correct,n=t?Math.floor(3+3*Math.random()):4;this.sound=new y(this.notes,e,n)},e.prototype.addAnswerButtons=function(){var t=this,e=Object.keys(this.notes),n=this.settings,r=n.canvasSize,o=n.noteRadius,i=this.dom.canvas.clientWidth,a=2*Math.PI/e.length,s=i/2,c=o*(i/r);e.forEach((function(e,n){var r=a*n-Math.PI/2,o=new v(e,r,c,s);t.answers.push(o),t.wrapper.append(o),o.addEventListener("click",(function(){window.navigator.vibrate&&window.navigator.vibrate(50),t.scoreboard.check(e),t.newRound()}))}))},e.prototype.addSoundButtonListeners=function(){var t=this,e=this.dom.button;e.addEventListener("click",(function(n){n.preventDefault(),e.disabled=!0,t.toggleSoundAnimation(!0),window.navigator.vibrate&&window.navigator.vibrate(50),setTimeout((function(){t.toggleSoundAnimation(!1),e.disabled=!1}),2e3),t.sound.play()}))},e.prototype.toggleSoundAnimation=function(t){var e,n;void 0===t&&(t=!1);try{for(var r=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.nodes),o=r.next();!o.done;o=r.next()){var i=o.value;t?i.start():i.end()}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},e}(d))("app",t,e)})()})();